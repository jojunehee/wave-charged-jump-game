<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WCJG Admin - Cheat Logs</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      min-height: 100vh;
      color: #eee;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }
    
    header {
      text-align: center;
      padding: 30px 0;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      margin-bottom: 30px;
    }
    
    header h1 {
      font-size: 2em;
      color: #ff6b6b;
      margin-bottom: 10px;
    }
    
    header p {
      color: #888;
    }
    
    .login-section {
      max-width: 400px;
      margin: 50px auto;
      background: rgba(255,255,255,0.05);
      padding: 30px;
      border-radius: 15px;
      border: 1px solid rgba(255,255,255,0.1);
    }
    
    .login-section h2 {
      margin-bottom: 20px;
      color: #ffd93d;
    }
    
    .login-section input {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 8px;
      background: rgba(0,0,0,0.3);
      color: #fff;
      font-size: 1em;
      margin-bottom: 15px;
    }
    
    .login-section input:focus {
      outline: none;
      border-color: #ffd93d;
    }
    
    .login-section button {
      width: 100%;
      padding: 12px;
      background: linear-gradient(135deg, #ff6b6b, #ffd93d);
      border: none;
      border-radius: 8px;
      color: #1a1a2e;
      font-size: 1em;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .login-section button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(255,107,107,0.4);
    }
    
    .error-msg {
      color: #ff6b6b;
      margin-top: 10px;
      display: none;
    }
    
    .dashboard {
      display: none;
    }
    
    /* íƒ­ ìŠ¤íƒ€ì¼ */
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 25px;
    }
    
    .tab-btn {
      padding: 12px 25px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 10px;
      color: #888;
      font-size: 1em;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .tab-btn:hover {
      background: rgba(255,255,255,0.1);
      color: #fff;
    }
    
    .tab-btn.active {
      background: linear-gradient(135deg, #ff6b6b, #ffd93d);
      color: #1a1a2e;
      border: none;
      font-weight: bold;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .stat-card {
      background: rgba(255,255,255,0.05);
      padding: 20px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.1);
      text-align: center;
    }
    
    .stat-card .number {
      font-size: 2.5em;
      font-weight: bold;
      color: #ffd93d;
    }
    
    .stat-card .label {
      color: #888;
      margin-top: 5px;
    }
    
    .controls {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
      flex-wrap: wrap;
      align-items: center;
    }
    
    .controls select, .controls input, .controls button {
      padding: 10px 15px;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.2);
      background: rgba(0,0,0,0.3);
      color: #fff;
      cursor: pointer;
    }
    
    .controls input[type="date"] {
      min-width: 150px;
    }
    
    .controls button {
      background: linear-gradient(135deg, #4ecdc4, #44a08d);
      border: none;
      font-weight: bold;
    }
    
    .controls button:hover {
      opacity: 0.9;
    }
    
    .controls button.logout-btn {
      background: linear-gradient(135deg, #666, #444);
    }
    
    .controls label {
      color: #888;
      font-size: 0.9em;
    }
    
    .logs-table, .leaderboard-table {
      width: 100%;
      border-collapse: collapse;
      background: rgba(255,255,255,0.02);
      border-radius: 12px;
      overflow: hidden;
    }
    
    .logs-table th, .logs-table td,
    .leaderboard-table th, .leaderboard-table td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    
    .logs-table th, .leaderboard-table th {
      background: rgba(255,107,107,0.2);
      color: #ffd93d;
      font-weight: 600;
    }
    
    .logs-table tr:hover, .leaderboard-table tr:hover {
      background: rgba(255,255,255,0.05);
    }
    
    .suspicious {
      color: #ff6b6b;
      font-weight: bold;
    }
    
    .cheater-row {
      background: rgba(255,107,107,0.15) !important;
    }
    
    .cheater-badge {
      background: #ff6b6b;
      color: #fff;
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 0.75em;
      margin-left: 8px;
    }
    
    .clean-badge {
      background: #4ecdc4;
      color: #1a1a2e;
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 0.75em;
      margin-left: 8px;
    }
    
    .detail-btn {
      padding: 5px 12px;
      background: #4ecdc4;
      border: none;
      border-radius: 5px;
      color: #1a1a2e;
      cursor: pointer;
      font-size: 0.85em;
    }
    
    .detail-btn:hover {
      background: #44a08d;
    }
    
    /* ëª¨ë‹¬ */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      z-index: 1000;
      overflow-y: auto;
    }
    
    .modal-content {
      max-width: 900px;
      margin: 50px auto;
      background: #1a1a2e;
      border-radius: 15px;
      border: 1px solid rgba(255,255,255,0.1);
      overflow: hidden;
    }
    
    .modal-header {
      padding: 20px;
      background: rgba(255,107,107,0.2);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .modal-header h3 {
      color: #ffd93d;
    }
    
    .modal-close {
      background: none;
      border: none;
      color: #fff;
      font-size: 1.5em;
      cursor: pointer;
    }
    
    .modal-body {
      padding: 20px;
    }
    
    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .info-item {
      background: rgba(255,255,255,0.05);
      padding: 15px;
      border-radius: 8px;
    }
    
    .info-item .label {
      color: #888;
      font-size: 0.85em;
      margin-bottom: 5px;
    }
    
    .info-item .value {
      font-size: 1.1em;
      color: #fff;
    }
    
    .jump-logs-section h4 {
      margin-bottom: 15px;
      color: #4ecdc4;
    }
    
    .jump-logs-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9em;
    }
    
    .jump-logs-table th, .jump-logs-table td {
      padding: 8px 10px;
      border: 1px solid rgba(255,255,255,0.1);
      text-align: center;
    }
    
    .jump-logs-table th {
      background: rgba(78,205,196,0.2);
      color: #4ecdc4;
    }
    
    .jump-logs-table .cheat-jump {
      background: rgba(255,107,107,0.2);
      color: #ff6b6b;
    }
    
    .loading {
      text-align: center;
      padding: 50px;
      color: #888;
    }
    
    .no-data {
      text-align: center;
      padding: 50px;
      color: #666;
    }
    
    .summary-bar {
      background: rgba(255,255,255,0.05);
      padding: 15px 20px;
      border-radius: 10px;
      margin-bottom: 20px;
      display: flex;
      gap: 30px;
      flex-wrap: wrap;
    }
    
    .summary-item {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .summary-item .label {
      color: #888;
    }
    
    .summary-item .value {
      font-weight: bold;
      color: #ffd93d;
    }
    
    .summary-item .value.danger {
      color: #ff6b6b;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ğŸ›¡ï¸ WCJG Admin Panel</h1>
      <p>ì¹˜íŠ¸ ë¡œê·¸ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ</p>
    </header>
    
    <!-- ë¡œê·¸ì¸ ì„¹ì…˜ -->
    <div class="login-section" id="loginSection">
      <h2>ğŸ” ê´€ë¦¬ì ì¸ì¦</h2>
      <input type="password" id="adminKey" placeholder="ê´€ë¦¬ì í‚¤ ì…ë ¥...">
      <button onclick="login()">ë¡œê·¸ì¸</button>
      <p class="error-msg" id="errorMsg">ì¸ì¦ ì‹¤íŒ¨. í‚¤ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.</p>
    </div>
    
    <!-- ëŒ€ì‹œë³´ë“œ -->
    <div class="dashboard" id="dashboard">
      <!-- íƒ­ ë²„íŠ¼ -->
      <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('leaderboard')">ğŸ† ë¦¬ë”ë³´ë“œ</button>
        <button class="tab-btn" onclick="switchTab('cheatLogs')">ğŸš¨ ì¹˜íŠ¸ ë¡œê·¸</button>
        <button class="tab-btn logout-btn" onclick="logout()" style="margin-left:auto;">ğŸšª ë¡œê·¸ì•„ì›ƒ</button>
      </div>
      
      <!-- ë¦¬ë”ë³´ë“œ íƒ­ -->
      <div class="tab-content active" id="leaderboardTab">
        <div class="controls">
          <label>ê¸°ê°„:</label>
          <input type="date" id="fromDate">
          <span style="color:#888;">~</span>
          <input type="date" id="toDate">
          <select id="lbLimitSelect">
            <option value="20">ìƒìœ„ 20ëª…</option>
            <option value="50" selected>ìƒìœ„ 50ëª…</option>
            <option value="100">ìƒìœ„ 100ëª…</option>
          </select>
          <button onclick="fetchLeaderboard()">ğŸ”„ ì¡°íšŒ</button>
        </div>
        
        <div class="summary-bar" id="lbSummary" style="display:none;">
          <div class="summary-item">
            <span class="label">ì¡°íšŒ ê²°ê³¼:</span>
            <span class="value" id="lbTotal">0</span><span class="label">ëª…</span>
          </div>
          <div class="summary-item">
            <span class="label">ì¹˜íŠ¸ ì˜ì‹¬:</span>
            <span class="value danger" id="lbCheaters">0</span><span class="label">ëª…</span>
          </div>
        </div>
        
        <div id="leaderboardContainer">
          <p class="no-data">ê¸°ê°„ì„ ì„¤ì •í•˜ê³  ì¡°íšŒ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</p>
        </div>
      </div>
      
      <!-- ì¹˜íŠ¸ ë¡œê·¸ íƒ­ -->
      <div class="tab-content" id="cheatLogsTab">
        <div class="stats">
          <div class="stat-card">
            <div class="number" id="totalCount">-</div>
            <div class="label">ì´ ì¹˜íŠ¸ ê¸°ë¡</div>
          </div>
          <div class="stat-card">
            <div class="number" id="todayCount">-</div>
            <div class="label">ì˜¤ëŠ˜ ê¸°ë¡</div>
          </div>
          <div class="stat-card">
            <div class="number" id="avgScore">-</div>
            <div class="label">í‰ê·  ì ìˆ˜</div>
          </div>
          <div class="stat-card">
            <div class="number" id="topCheater">-</div>
            <div class="label">ìµœë‹¤ ì ë°œì</div>
          </div>
        </div>
        
        <div class="controls">
          <select id="limitSelect">
            <option value="20">ìµœê·¼ 20ê°œ</option>
            <option value="50" selected>ìµœê·¼ 50ê°œ</option>
            <option value="100">ìµœê·¼ 100ê°œ</option>
            <option value="200">ìµœê·¼ 200ê°œ</option>
          </select>
          <button onclick="fetchLogs()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
        </div>
        
        <div id="logsContainer">
          <p class="loading">ë¡œë”© ì¤‘...</p>
        </div>
      </div>
    </div>
  </div>
  
  <!-- ìƒì„¸ ëª¨ë‹¬ -->
  <div class="modal" id="detailModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>ğŸ“‹ ìƒì„¸ ì •ë³´</h3>
        <button class="modal-close" onclick="closeModal()">&times;</button>
      </div>
      <div class="modal-body" id="modalBody">
      </div>
    </div>
  </div>

  <script>
    const API_BASE = (location.hostname === 'localhost' || location.hostname === '127.0.0.1')
      ? 'http://localhost:8080'
      : 'https://wave-charged-jump-game.onrender.com';
    
    let adminKey = '';
    let logsData = [];
    let leaderboardData = [];
    
    // íƒ­ ì „í™˜
    function switchTab(tabName) {
      document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
      
      if (tabName === 'leaderboard') {
        document.querySelector('.tab-btn:nth-child(1)').classList.add('active');
        document.getElementById('leaderboardTab').classList.add('active');
      } else {
        document.querySelector('.tab-btn:nth-child(2)').classList.add('active');
        document.getElementById('cheatLogsTab').classList.add('active');
        if (logsData.length === 0) fetchLogs();
      }
    }
    
    async function login() {
      const keyInput = document.getElementById('adminKey');
      const errorMsg = document.getElementById('errorMsg');
      adminKey = keyInput.value.trim();
      
      if (!adminKey) {
        errorMsg.style.display = 'block';
        errorMsg.textContent = 'í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.';
        return;
      }
      
      try {
        const res = await fetch(`${API_BASE}/api/cheat-logs/admin?key=${encodeURIComponent(adminKey)}&limit=1`);
        
        if (res.status === 401) {
          errorMsg.style.display = 'block';
          errorMsg.textContent = 'ì¸ì¦ ì‹¤íŒ¨. í‚¤ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.';
          return;
        }
        
        if (!res.ok) throw new Error('Server error');
        
        // ë¡œê·¸ì¸ ì„±ê³µ
        errorMsg.style.display = 'none';
        document.getElementById('loginSection').style.display = 'none';
        document.getElementById('dashboard').style.display = 'block';
        
        // í‚¤ ì €ì¥ (ì„¸ì…˜)
        sessionStorage.setItem('adminKey', adminKey);
        
        // ê¸°ë³¸ ë‚ ì§œ ì„¤ì • (ìµœê·¼ 30ì¼)
        const today = new Date();
        const thirtyDaysAgo = new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000);
        document.getElementById('toDate').value = today.toISOString().split('T')[0];
        document.getElementById('fromDate').value = thirtyDaysAgo.toISOString().split('T')[0];
        
      } catch (e) {
        errorMsg.style.display = 'block';
        errorMsg.textContent = 'ì„œë²„ ì—°ê²° ì‹¤íŒ¨. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
      }
    }
    
    function logout() {
      adminKey = '';
      sessionStorage.removeItem('adminKey');
      document.getElementById('loginSection').style.display = 'block';
      document.getElementById('dashboard').style.display = 'none';
      document.getElementById('adminKey').value = '';
    }
    
    // ë¦¬ë”ë³´ë“œ ì¡°íšŒ
    async function fetchLeaderboard() {
      const limit = document.getElementById('lbLimitSelect').value;
      const from = document.getElementById('fromDate').value;
      const to = document.getElementById('toDate').value;
      const container = document.getElementById('leaderboardContainer');
      
      container.innerHTML = '<p class="loading">ë¡œë”© ì¤‘...</p>';
      
      let url = `${API_BASE}/api/cheat-logs/admin/leaderboard?key=${encodeURIComponent(adminKey)}&limit=${limit}`;
      if (from) url += `&from=${from}`;
      if (to) url += `&to=${to}`;
      
      try {
        const res = await fetch(url);
        
        if (res.status === 401) {
          logout();
          return;
        }
        
        const data = await res.json();
        leaderboardData = data.items || [];
        
        // ìš”ì•½ í‘œì‹œ
        document.getElementById('lbSummary').style.display = 'flex';
        document.getElementById('lbTotal').textContent = data.count || 0;
        document.getElementById('lbCheaters').textContent = data.cheater_count || 0;
        
        renderLeaderboard();
      } catch (e) {
        container.innerHTML = '<p class="no-data">ë°ì´í„° ë¡œë”© ì‹¤íŒ¨</p>';
      }
    }
    
    function renderLeaderboard() {
      const container = document.getElementById('leaderboardContainer');
      
      if (leaderboardData.length === 0) {
        container.innerHTML = '<p class="no-data">í•´ë‹¹ ê¸°ê°„ì— ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
        return;
      }
      
      let html = `
        <table class="leaderboard-table">
          <thead>
            <tr>
              <th>ìˆœìœ„</th>
              <th>í”Œë ˆì´ì–´</th>
              <th>ì ìˆ˜</th>
              <th>ê¸°ë¡ì¼</th>
              <th>ìƒíƒœ</th>
            </tr>
          </thead>
          <tbody>
      `;
      
      for (const item of leaderboardData) {
        const date = new Date(item.created_at).toLocaleDateString('ko-KR');
        const isCheater = item.is_cheater;
        const rowClass = isCheater ? 'cheater-row' : '';
        
        let rankDisplay = item.rank;
        if (item.rank === 1) rankDisplay = 'ğŸ¥‡ 1';
        else if (item.rank === 2) rankDisplay = 'ğŸ¥ˆ 2';
        else if (item.rank === 3) rankDisplay = 'ğŸ¥‰ 3';
        
        html += `
          <tr class="${rowClass}">
            <td>${rankDisplay}</td>
            <td>
              ${escapeHtml(item.name)}
              ${isCheater ? '<span class="cheater-badge">âš ï¸ ì¹˜íŠ¸ ì˜ì‹¬</span>' : ''}
            </td>
            <td>${item.score.toLocaleString()}</td>
            <td>${date}</td>
            <td>
              ${isCheater 
                ? '<span class="suspicious">ğŸš¨ ì˜ì‹¬</span>' 
                : '<span style="color:#4ecdc4;">âœ“ ì •ìƒ</span>'}
            </td>
          </tr>
        `;
      }
      
      html += '</tbody></table>';
      container.innerHTML = html;
    }
    
    // ì¹˜íŠ¸ ë¡œê·¸ ì¡°íšŒ
    async function fetchLogs() {
      const limit = document.getElementById('limitSelect').value;
      const container = document.getElementById('logsContainer');
      container.innerHTML = '<p class="loading">ë¡œë”© ì¤‘...</p>';
      
      try {
        const res = await fetch(`${API_BASE}/api/cheat-logs/admin?key=${encodeURIComponent(adminKey)}&limit=${limit}`);
        
        if (res.status === 401) {
          logout();
          return;
        }
        
        const data = await res.json();
        logsData = data.items || [];
        
        updateStats();
        renderTable();
      } catch (e) {
        container.innerHTML = '<p class="no-data">ë°ì´í„° ë¡œë”© ì‹¤íŒ¨</p>';
      }
    }
    
    function updateStats() {
      document.getElementById('totalCount').textContent = logsData.length;
      
      // ì˜¤ëŠ˜ ê¸°ë¡
      const today = new Date().toISOString().split('T')[0];
      const todayLogs = logsData.filter(log => log.created_at.startsWith(today));
      document.getElementById('todayCount').textContent = todayLogs.length;
      
      // í‰ê·  ì ìˆ˜
      if (logsData.length > 0) {
        const avgScore = logsData.reduce((sum, log) => sum + log.score, 0) / logsData.length;
        document.getElementById('avgScore').textContent = Math.round(avgScore);
      } else {
        document.getElementById('avgScore').textContent = '-';
      }
      
      // ìµœë‹¤ ì ë°œì
      const nameCounts = {};
      logsData.forEach(log => {
        nameCounts[log.player_name] = (nameCounts[log.player_name] || 0) + 1;
      });
      const topName = Object.entries(nameCounts).sort((a, b) => b[1] - a[1])[0];
      document.getElementById('topCheater').textContent = topName ? `${topName[0]} (${topName[1]})` : '-';
    }
    
    function renderTable() {
      const container = document.getElementById('logsContainer');
      
      if (logsData.length === 0) {
        container.innerHTML = '<p class="no-data">ì¹˜íŠ¸ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤ ğŸ‰</p>';
        return;
      }
      
      let html = `
        <table class="logs-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>í”Œë ˆì´ì–´</th>
              <th>ì ìˆ˜</th>
              <th>ìµœê³ ë†’ì´</th>
              <th>ê°€ëŠ¥ë†’ì´</th>
              <th>ì°¨ì´</th>
              <th>ëª¨ë“œ</th>
              <th>ì‹œê°„</th>
              <th>ìƒì„¸</th>
            </tr>
          </thead>
          <tbody>
      `;
      
      for (const log of logsData) {
        const diff = (log.max_reached_height - log.possible_max_height).toFixed(1);
        const date = new Date(log.created_at).toLocaleString('ko-KR');
        
        html += `
          <tr>
            <td>${log.id}</td>
            <td>${escapeHtml(log.player_name)}</td>
            <td>${log.score}</td>
            <td>${log.max_reached_height.toFixed(1)}</td>
            <td>${log.possible_max_height.toFixed(1)}</td>
            <td class="suspicious">+${diff}</td>
            <td>${log.game_mode || '-'}</td>
            <td>${date}</td>
            <td><button class="detail-btn" onclick="showDetail(${log.id})">ë³´ê¸°</button></td>
          </tr>
        `;
      }
      
      html += '</tbody></table>';
      container.innerHTML = html;
    }
    
    function showDetail(id) {
      const log = logsData.find(l => l.id === id);
      if (!log) return;
      
      const diff = (log.max_reached_height - log.possible_max_height).toFixed(2);
      const date = new Date(log.created_at).toLocaleString('ko-KR');
      
      let jumpLogsHtml = '<p class="no-data">ì í”„ ë¡œê·¸ ì—†ìŒ</p>';
      
      if (log.jump_logs) {
        try {
          const jumps = JSON.parse(log.jump_logs);
          if (jumps.length > 0) {
            // ìµœëŒ€ ì í”„ ë†’ì´ ê³„ì‚° (íƒ€ì…ë³„)
            const maxNormal = 28;
            const maxBounce = 28;
            const maxSuper = 52;
            
            jumpLogsHtml = `
              <table class="jump-logs-table">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>ì‹œì‘ Y</th>
                    <th>ë Y</th>
                    <th>ë†’ì´</th>
                    <th>íƒ€ì…</th>
                  </tr>
                </thead>
                <tbody>
            `;
            
            for (const j of jumps) {
              const maxAllowed = j.type === 'superBounce' ? maxSuper : maxNormal;
              const isCheat = j.height > maxAllowed;
              
              jumpLogsHtml += `
                <tr class="${isCheat ? 'cheat-jump' : ''}">
                  <td>${j.jump_num}</td>
                  <td>${j.start_y}</td>
                  <td>${j.end_y}</td>
                  <td>${j.height}${isCheat ? ' âš ï¸' : ''}</td>
                  <td>${j.type}</td>
                </tr>
              `;
            }
            
            jumpLogsHtml += '</tbody></table>';
          }
        } catch (e) {
          jumpLogsHtml = '<p class="no-data">ì í”„ ë¡œê·¸ íŒŒì‹± ì˜¤ë¥˜</p>';
        }
      }
      
      document.getElementById('modalBody').innerHTML = `
        <div class="info-grid">
          <div class="info-item">
            <div class="label">í”Œë ˆì´ì–´</div>
            <div class="value">${escapeHtml(log.player_name)}</div>
          </div>
          <div class="info-item">
            <div class="label">ì ìˆ˜</div>
            <div class="value">${log.score}</div>
          </div>
          <div class="info-item">
            <div class="label">í”Œë ˆì´ ì‹œê°„</div>
            <div class="value">${log.play_time_seconds}ì´ˆ</div>
          </div>
          <div class="info-item">
            <div class="label">ê²Œì„ ëª¨ë“œ</div>
            <div class="value">${log.game_mode || '-'}</div>
          </div>
          <div class="info-item">
            <div class="label">ìµœê³  ë„ë‹¬ ë†’ì´</div>
            <div class="value">${log.max_reached_height.toFixed(2)}</div>
          </div>
          <div class="info-item">
            <div class="label">ê°€ëŠ¥ ìµœëŒ€ ë†’ì´</div>
            <div class="value">${log.possible_max_height.toFixed(2)}</div>
          </div>
          <div class="info-item">
            <div class="label">ëˆ„ì  ì í”„</div>
            <div class="value">${log.total_positive_jumps.toFixed(2)}</div>
          </div>
          <div class="info-item">
            <div class="label">ì´ˆê³¼ ë†’ì´</div>
            <div class="value" style="color:#ff6b6b;">+${diff}</div>
          </div>
          <div class="info-item" style="grid-column: 1 / -1;">
            <div class="label">ë””ë°”ì´ìŠ¤</div>
            <div class="value" style="font-size:0.85em; word-break:break-all;">${escapeHtml(log.device_info || '-')}</div>
          </div>
          <div class="info-item">
            <div class="label">ê¸°ë¡ ì‹œê°„</div>
            <div class="value">${date}</div>
          </div>
        </div>
        
        <div class="jump-logs-section">
          <h4>ğŸ¦˜ ì í”„ ë¡œê·¸ (${log.jump_logs ? JSON.parse(log.jump_logs).length : 0}ê°œ)</h4>
          ${jumpLogsHtml}
        </div>
      `;
      
      document.getElementById('detailModal').style.display = 'block';
    }
    
    function closeModal() {
      document.getElementById('detailModal').style.display = 'none';
    }
    
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
    document.getElementById('detailModal').addEventListener('click', (e) => {
      if (e.target.id === 'detailModal') closeModal();
    });
    
    // Enter í‚¤ë¡œ ë¡œê·¸ì¸
    document.getElementById('adminKey').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') login();
    });
    
    // ì„¸ì…˜ì—ì„œ í‚¤ ë³µì›
    window.onload = () => {
      const savedKey = sessionStorage.getItem('adminKey');
      if (savedKey) {
        adminKey = savedKey;
        document.getElementById('loginSection').style.display = 'none';
        document.getElementById('dashboard').style.display = 'block';
        
        // ê¸°ë³¸ ë‚ ì§œ ì„¤ì •
        const today = new Date();
        const thirtyDaysAgo = new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000);
        document.getElementById('toDate').value = today.toISOString().split('T')[0];
        document.getElementById('fromDate').value = thirtyDaysAgo.toISOString().split('T')[0];
      }
    };
  </script>
</body>
</html>
